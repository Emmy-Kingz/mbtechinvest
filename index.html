<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nexus Crypto Broker | Institutional Grade Trading</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Firebase App (the core Firebase SDK) -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <!-- Firebase Services -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        
        body { 
            font-family: 'Inter', sans-serif;
            background: #020617; 
            color: #f8fafc; 
        }
        
        .glass { 
            background: rgba(15, 23, 42, 0.6); 
            backdrop-filter: blur(12px); 
            border: 1px solid rgba(255, 255, 255, 0.08); 
        }
        
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        .gradient-text {
            background: linear-gradient(to right, #60a5fa, #a855f7);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Smooth transitions */
        .transition-all { transition: all 0.3s ease; }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- HEADER -->
    <header class="glass sticky top-0 z-[60] w-full border-b border-slate-800">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
            <div class="flex items-center gap-2">
                <div class="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center">
                    <i class="fas fa-chart-line text-white"></i>
                </div>
                <span class="text-xl font-bold tracking-tight">NEXUS<span class="text-blue-500">BROKER</span></span>
            </div>
            
            <div id="nav-auth-info" class="hidden flex items-center gap-4">
                <div class="hidden md:flex flex-col items-end">
                    <span id="header-user-name" class="text-sm font-semibold">User</span>
                    <span id="header-user-tier" class="text-[10px] uppercase tracking-widest text-blue-400">Loading...</span>
                </div>
                <button onclick="logout()" class="p-2 hover:bg-red-500/10 text-red-400 rounded-full transition-all">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </div>
    </header>

    <main class="flex-grow">
        <!-- Auth Section -->
        <div id="auth-section" class="flex items-center justify-center min-h-[80vh] px-4">
            <div class="glass p-8 rounded-2xl w-full max-w-md shadow-2xl border-t-4 border-blue-500">
                <h1 class="text-3xl font-bold text-center mb-2">Welcome Back</h1>
                <p class="text-slate-400 text-center mb-8 text-sm">Secure Institutional Trading Portal</p>
                
                <div id="login-form">
                    <div class="space-y-4">
                        <input type="email" id="login-email" placeholder="Email Address" class="w-full p-3 rounded-xl bg-slate-900/50 border border-slate-700 focus:border-blue-500 outline-none">
                        <input type="password" id="login-pass" placeholder="Password" class="w-full p-3 rounded-xl bg-slate-900/50 border border-slate-700 focus:border-blue-500 outline-none">
                    </div>
                    <button onclick="login()" class="w-full bg-blue-600 hover:bg-blue-700 mt-6 py-3 rounded-xl font-bold transition-all shadow-lg shadow-blue-500/20">Login to Dashboard</button>
                    
                    <div class="relative my-6">
                        <div class="absolute inset-0 flex items-center"><div class="w-full border-t border-slate-800"></div></div>
                        <div class="relative flex justify-center text-xs uppercase"><span class="bg-[#020617] px-2 text-slate-500">Or continue with</span></div>
                    </div>

                    <button onclick="googleSignIn()" class="w-full bg-white text-black py-3 rounded-xl font-bold flex items-center justify-center gap-2 hover:bg-slate-100 transition-all">
                        <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="18"> Google Account
                    </button>
                    <p class="text-center mt-6 text-sm text-slate-400">New investor? <a href="#" onclick="toggleAuth(false)" class="text-blue-400 font-semibold hover:underline">Create Account</a></p>
                </div>

                <div id="signup-form" class="hidden">
                    <div class="space-y-3">
                        <input type="text" id="reg-name" placeholder="Full Name" class="w-full p-3 rounded-xl bg-slate-900/50 border border-slate-700 outline-none">
                        <input type="email" id="reg-email" placeholder="Email Address" class="w-full p-3 rounded-xl bg-slate-900/50 border border-slate-700 outline-none">
                        <input type="password" id="reg-pass" placeholder="Password" class="w-full p-3 rounded-xl bg-slate-900/50 border border-slate-700 outline-none">
                        <p class="text-[10px] text-slate-500 uppercase font-bold pt-2">Withdrawal Credentials</p>
                        <input type="text" id="reg-btc" placeholder="BTC Wallet Address" class="w-full p-3 rounded-xl bg-slate-900/50 border border-slate-700 outline-none">
                        <input type="text" id="reg-usd" placeholder="USDT (TRC20) Address" class="w-full p-3 rounded-xl bg-slate-900/50 border border-slate-700 outline-none">
                        <input type="text" id="reg-sol" placeholder="SOL Wallet Address" class="w-full p-3 rounded-xl bg-slate-900/50 border border-slate-700 outline-none">
                    </div>
                    <button onclick="signUp()" class="w-full bg-blue-600 hover:bg-blue-700 mt-6 py-3 rounded-xl font-bold transition-all">Register Account</button>
                    <p class="text-center mt-6 text-sm text-slate-400">Already a member? <a href="#" onclick="toggleAuth(true)" class="text-blue-400 font-semibold hover:underline">Login</a></p>
                </div>
            </div>
        </div>

        <!-- Main App Dashboard -->
        <div id="app-section" class="hidden pb-24">
            <div class="max-w-7xl mx-auto p-4 sm:p-6 lg:px-8">
                
                <!-- Market Ticker (Mobile Friendly) -->
                <div class="grid grid-cols-2 lg:grid-cols-4 gap-3 mb-8" id="market-prices">
                    <div class="glass p-4 rounded-2xl flex items-center justify-between">
                        <div><p class="text-[10px] uppercase text-slate-400">Bitcoin</p><p id="price-btc" class="font-bold text-sm">...</p></div>
                        <i class="fab fa-bitcoin text-orange-500 text-xl opacity-20"></i>
                    </div>
                    <div class="glass p-4 rounded-2xl flex items-center justify-between">
                        <div><p class="text-[10px] uppercase text-slate-400">Ethereum</p><p id="price-eth" class="font-bold text-sm">...</p></div>
                        <i class="fab fa-ethereum text-blue-400 text-xl opacity-20"></i>
                    </div>
                    <div class="glass p-4 rounded-2xl flex items-center justify-between">
                        <div><p class="text-[10px] uppercase text-slate-400">Solana</p><p id="price-sol" class="font-bold text-sm">...</p></div>
                        <i class="fas fa-coins text-purple-500 text-xl opacity-20"></i>
                    </div>
                    <div class="glass p-4 rounded-2xl flex items-center justify-between">
                        <div><p class="text-[10px] uppercase text-slate-400">USDT</p><p class="font-bold text-sm">$1.00</p></div>
                        <i class="fas fa-dollar-sign text-green-500 text-xl opacity-20"></i>
                    </div>
                </div>

                <!-- Portfolio Grid -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-10">
                    <div class="relative overflow-hidden bg-gradient-to-br from-blue-700 to-indigo-900 p-6 rounded-3xl shadow-xl">
                        <div class="relative z-10">
                            <p class="text-blue-100/70 text-sm font-medium">Invested Capital</p>
                            <h2 id="stat-capital" class="text-4xl font-bold mt-1 tracking-tight">$0.00</h2>
                            <div class="mt-6 flex items-center gap-2">
                                <span id="user-tier-badge" class="text-[10px] bg-white/20 px-3 py-1 rounded-full backdrop-blur-md font-bold uppercase tracking-wider">Loading...</span>
                            </div>
                        </div>
                        <div class="absolute -right-4 -bottom-4 opacity-10">
                            <i class="fas fa-wallet text-9xl"></i>
                        </div>
                    </div>

                    <div class="glass p-6 rounded-3xl flex flex-col justify-between">
                        <div>
                            <p class="text-slate-400 text-sm">Current Revenue</p>
                            <h2 id="stat-revenue" class="text-4xl font-bold mt-1 text-green-400 tracking-tight">$0.00</h2>
                        </div>
                        <p class="text-[10px] text-slate-500 mt-4 uppercase">Compounded every 12 hours</p>
                    </div>

                    <div class="glass p-6 rounded-3xl border-dashed border-blue-500/20 flex flex-col justify-between">
                        <div>
                            <p class="text-slate-400 text-sm">72hr Projection</p>
                            <h2 id="stat-projected" class="text-4xl font-bold mt-1 text-blue-400 tracking-tight">$0.00</h2>
                        </div>
                        <p class="text-[10px] text-blue-500/50 mt-4 uppercase font-bold">Estimated earnings</p>
                    </div>
                </div>

                <!-- Section Tabs -->
                <div class="flex gap-2 mb-8 bg-slate-900/50 p-1 rounded-2xl w-fit">
                    <button onclick="showTab('investment')" class="tab-btn px-6 py-2.5 rounded-xl bg-blue-600 font-semibold text-sm transition-all">Invest</button>
                    <button onclick="showTab('wallet')" class="tab-btn px-6 py-2.5 rounded-xl text-slate-400 font-semibold text-sm transition-all">Wallet</button>
                    <button id="admin-tab-btn" onclick="showTab('admin')" class="tab-btn px-6 py-2.5 rounded-xl text-slate-400 font-semibold text-sm hidden transition-all">Admin Panel</button>
                </div>

                <!-- Tab: Investment -->
                <div id="tab-investment" class="tab-content active">
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Plans (Same logic as before but with updated styling) -->
                        <div class="glass p-8 rounded-3xl border-b-4 border-slate-500 hover:scale-[1.02] transition-all">
                            <span class="text-slate-400 text-xs font-bold uppercase tracking-widest">Starter</span>
                            <h3 class="text-2xl font-bold mt-1">Silver Plan</h3>
                            <div class="my-6">
                                <span class="text-4xl font-bold">1%</span>
                                <span class="text-slate-500"> / 12hrs</span>
                            </div>
                            <ul class="space-y-4 text-sm text-slate-400 mb-8">
                                <li class="flex items-center gap-2"><i class="fas fa-check-circle text-blue-500"></i> $100 - $999</li>
                                <li class="flex items-center gap-2"><i class="fas fa-check-circle text-blue-500"></i> Auto-Compounding</li>
                                <li class="flex items-center gap-2"><i class="fas fa-check-circle text-blue-500"></i> Standard Support</li>
                            </ul>
                            <button onclick="initiateDeposit('Silver')" class="w-full py-4 bg-slate-800 hover:bg-slate-700 rounded-2xl font-bold transition-all border border-slate-700">Get Silver</button>
                        </div>

                        <div class="glass p-8 rounded-3xl border-b-4 border-yellow-500 hover:scale-[1.02] transition-all relative">
                            <div class="absolute -top-3 left-1/2 -translate-x-1/2 bg-yellow-500 text-black text-[10px] font-bold px-3 py-1 rounded-full uppercase tracking-tighter">Most Popular</div>
                            <span class="text-yellow-500/80 text-xs font-bold uppercase tracking-widest">Growth</span>
                            <h3 class="text-2xl font-bold mt-1">Gold Plan</h3>
                            <div class="my-6">
                                <span class="text-4xl font-bold">1.5%</span>
                                <span class="text-slate-500"> / 12hrs</span>
                            </div>
                            <ul class="space-y-4 text-sm text-slate-400 mb-8">
                                <li class="flex items-center gap-2"><i class="fas fa-check-circle text-yellow-500"></i> $1,000 - $9,999</li>
                                <li class="flex items-center gap-2"><i class="fas fa-check-circle text-yellow-500"></i> Priority Withdrawals</li>
                                <li class="flex items-center gap-2"><i class="fas fa-check-circle text-yellow-500"></i> Advanced Analytics</li>
                            </ul>
                            <button onclick="initiateDeposit('Gold')" class="w-full py-4 bg-yellow-600 hover:bg-yellow-500 text-black rounded-2xl font-bold transition-all">Upgrade to Gold</button>
                        </div>

                        <div class="glass p-8 rounded-3xl border-b-4 border-blue-400 hover:scale-[1.02] transition-all">
                            <span class="text-blue-400 text-xs font-bold uppercase tracking-widest">Elite</span>
                            <h3 class="text-2xl font-bold mt-1">Diamond Plan</h3>
                            <div class="my-6">
                                <span class="text-4xl font-bold">2.0%</span>
                                <span class="text-slate-500"> / 12hrs</span>
                            </div>
                            <ul class="space-y-4 text-sm text-slate-400 mb-8">
                                <li class="flex items-center gap-2"><i class="fas fa-check-circle text-blue-400"></i> $10,000 - Max</li>
                                <li class="flex items-center gap-2"><i class="fas fa-check-circle text-blue-400"></i> 24/7 VIP Manager</li>
                                <li class="flex items-center gap-2"><i class="fas fa-check-circle text-blue-400"></i> Zero Withdrawal Fees</li>
                            </ul>
                            <button onclick="initiateDeposit('Diamond')" class="w-full py-4 bg-blue-600 hover:bg-blue-500 rounded-2xl font-bold transition-all">Go Diamond</button>
                        </div>
                    </div>
                </div>

                <!-- Tab: Wallet -->
                <div id="tab-wallet" class="tab-content">
                    <div class="glass p-8 rounded-3xl max-w-2xl mx-auto shadow-2xl">
                        <div class="flex items-center gap-3 mb-8">
                            <div class="w-12 h-12 bg-green-500/10 rounded-2xl flex items-center justify-center">
                                <i class="fas fa-arrow-up text-green-500"></i>
                            </div>
                            <h3 class="text-2xl font-bold">Withdraw Assets</h3>
                        </div>
                        
                        <div class="mb-8 p-4 rounded-2xl bg-slate-900/50 border border-slate-800">
                            <p class="text-xs uppercase text-slate-500 font-bold mb-2">Security Lock Status</p>
                            <div id="eligibility-status" class="flex items-center gap-3 text-sm">
                                <i class="fas fa-shield-alt animate-pulse"></i>
                                <span>Evaluating network status...</span>
                            </div>
                        </div>

                        <div class="space-y-6">
                            <div>
                                <label class="text-xs font-bold uppercase text-slate-500 block mb-2">Network Selection</label>
                                <select id="withdraw-asset" class="w-full p-4 rounded-xl bg-slate-900 border border-slate-700 outline-none">
                                    <option value="btc">Bitcoin Network</option>
                                    <option value="usd">USDT (TRC20)</option>
                                    <option value="sol">Solana Ecosystem</option>
                                </select>
                            </div>
                            <div>
                                <label class="text-xs font-bold uppercase text-slate-500 block mb-2">Withdrawal Amount (USD)</label>
                                <input type="number" id="withdraw-amount" class="w-full p-4 rounded-xl bg-slate-900 border border-slate-700 outline-none font-bold text-xl" placeholder="0.00">
                                <p class="text-[10px] text-slate-500 mt-2">Maximum: Entire Revenue Balance</p>
                            </div>
                            <button onclick="requestWithdrawal()" class="w-full py-4 bg-green-600 hover:bg-green-700 rounded-2xl font-bold transition-all shadow-lg shadow-green-500/20">Confirm Withdrawal Request</button>
                        </div>
                    </div>
                </div>

                <!-- Tab: Admin Panel -->
                <div id="tab-admin" class="tab-content">
                    <div class="glass p-6 rounded-3xl">
                        <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8">
                            <h3 class="text-2xl font-bold">Investor Console</h3>
                            <div class="flex gap-2">
                                <span class="bg-blue-500/10 text-blue-400 px-3 py-1 rounded-lg text-xs font-bold uppercase">Admin Active</span>
                            </div>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full text-left">
                                <thead class="border-b border-slate-800">
                                    <tr class="text-xs uppercase text-slate-500 tracking-wider">
                                        <th class="pb-4">Investor Identity</th>
                                        <th class="pb-4">Portfolio Tier</th>
                                        <th class="pb-4">Active Capital</th>
                                        <th class="pb-4">Operations</th>
                                    </tr>
                                </thead>
                                <tbody id="admin-user-list" class="divide-y divide-slate-800">
                                    <!-- Dynamic Content -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </main>

    <!-- MOBILE NAVIGATION BAR (Shown on small screens) -->
    <div id="mobile-nav" class="md:hidden glass fixed bottom-0 left-0 right-0 h-16 border-t border-slate-800 flex justify-around items-center z-50 px-2 hidden">
        <button onclick="showTab('investment')" class="flex flex-col items-center gap-1 text-blue-400">
            <i class="fas fa-chart-pie"></i>
            <span class="text-[10px] font-bold">Invest</span>
        </button>
        <button onclick="showTab('wallet')" class="flex flex-col items-center gap-1 text-slate-500">
            <i class="fas fa-wallet"></i>
            <span class="text-[10px] font-bold">Wallet</span>
        </button>
        <button onclick="logout()" class="flex flex-col items-center gap-1 text-red-500">
            <i class="fas fa-sign-out-alt"></i>
            <span class="text-[10px] font-bold">Logout</span>
        </button>
    </div>

    <!-- FOOTER -->
    <footer class="glass border-t border-slate-800 py-12 px-4 mt-auto">
        <div class="max-w-7xl mx-auto">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-12 mb-12">
                <div class="md:col-span-2">
                    <div class="flex items-center gap-2 mb-4">
                        <div class="w-6 h-6 bg-blue-600 rounded flex items-center justify-center">
                            <i class="fas fa-chart-line text-white text-[10px]"></i>
                        </div>
                        <span class="text-lg font-bold">NEXUS<span class="text-blue-500">BROKER</span></span>
                    </div>
                    <p class="text-slate-400 text-sm max-w-sm">
                        Premier crypto-asset management and brokerage services. Regulated, secure, and focused on institutional-grade returns for retail investors.
                    </p>
                </div>
                <div>
                    <h4 class="font-bold mb-4 text-sm uppercase tracking-widest text-slate-500">Support</h4>
                    <ul class="text-slate-400 text-sm space-y-2">
                        <li><a href="#" class="hover:text-blue-400 transition-all">Help Center</a></li>
                        <li><a href="#" class="hover:text-blue-400 transition-all">Security Audit</a></li>
                        <li><a href="#" class="hover:text-blue-400 transition-all">Contact Us</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-bold mb-4 text-sm uppercase tracking-widest text-slate-500">Compliance</h4>
                    <ul class="text-slate-400 text-sm space-y-2">
                        <li><a href="#" class="hover:text-blue-400 transition-all">Terms of Service</a></li>
                        <li><a href="#" class="hover:text-blue-400 transition-all">Privacy Policy</a></li>
                        <li><a href="#" class="hover:text-blue-400 transition-all">Risk Warning</a></li>
                    </ul>
                </div>
            </div>
            <div class="pt-8 border-t border-slate-800 flex flex-col md:flex-row justify-between items-center gap-4">
                <p class="text-slate-500 text-[10px] uppercase font-bold tracking-widest">Â© 2026 Nexus Trading Group Inc. All Rights Reserved.</p>
                <div class="flex gap-6 text-slate-400">
                    <i class="fab fa-telegram-plane hover:text-blue-400 cursor-pointer"></i>
                    <i class="fab fa-twitter hover:text-blue-400 cursor-pointer"></i>
                    <i class="fab fa-linkedin-in hover:text-blue-400 cursor-pointer"></i>
                </div>
            </div>
        </div>
    </footer>

    <!-- Toast Component -->
    <div id="toast" class="fixed bottom-20 md:bottom-10 right-4 translate-y-32 transition duration-500 glass px-6 py-4 rounded-2xl shadow-2xl z-[100] text-sm font-semibold max-w-[90vw]"></div>

    <script>
        // --- FIREBASE CONFIG ---
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_PROJECT.firebaseapp.com",
            projectId: "YOUR_PROJECT",
            storageBucket: "YOUR_PROJECT.appspot.com",
            messagingSenderId: "YOUR_ID",
            appId: "YOUR_APP_ID"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        let currentUserData = null;

        // --- AUTH LOGIC ---
        function toggleAuth(isLogin) {
            document.getElementById('login-form').classList.toggle('hidden', !isLogin);
            document.getElementById('signup-form').classList.toggle('hidden', isLogin);
            document.querySelector('#auth-section h1').innerText = isLogin ? "Welcome Back" : "Create Account";
        }

        async function signUp() {
            const email = document.getElementById('reg-email').value;
            const pass = document.getElementById('reg-pass').value;
            const name = document.getElementById('reg-name').value;
            const btc = document.getElementById('reg-btc').value;
            const usd = document.getElementById('reg-usd').value;
            const sol = document.getElementById('reg-sol').value;

            if(!email || !pass || !name) return showToast("Please fill all required fields", true);

            try {
                const cred = await auth.createUserWithEmailAndPassword(email, pass);
                await db.collection('users').doc(cred.user.uid).set({
                    uid: cred.user.uid,
                    name: name,
                    email: email,
                    withdrawalAddresses: { btc, usd, sol },
                    investedCapital: 0,
                    tier: 'None',
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    investmentDate: null,
                    isAdmin: false
                });
                showToast("Portfolio Created Successfully!");
            } catch (e) { showToast(e.message, true); }
        }

        async function login() {
            const email = document.getElementById('login-email').value;
            const pass = document.getElementById('login-pass').value;
            try { 
                await auth.signInWithEmailAndPassword(email, pass); 
                showToast("Access Granted");
            } catch (e) { showToast(e.message, true); }
        }

        async function googleSignIn() {
            const provider = new firebase.auth.GoogleAuthProvider();
            try {
                const result = await auth.signInWithPopup(provider);
                const user = result.user;
                const docRef = db.collection('users').doc(user.uid);
                const doc = await docRef.get();
                if (!doc.exists) {
                    await docRef.set({
                        uid: user.uid,
                        name: user.displayName,
                        email: user.email,
                        withdrawalAddresses: { btc: '', usd: '', sol: '' },
                        investedCapital: 0,
                        tier: 'None',
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        investmentDate: null,
                        isAdmin: false
                    });
                }
                showToast("Signed in as " + user.displayName);
            } catch (e) { showToast(e.message, true); }
        }

        function logout() { auth.signOut(); location.reload(); }

        // --- APP STATE ---
        auth.onAuthStateChanged(user => {
            const appSection = document.getElementById('app-section');
            const authSection = document.getElementById('auth-section');
            const navAuth = document.getElementById('nav-auth-info');
            const mobileNav = document.getElementById('mobile-nav');

            if (user) {
                authSection.classList.add('hidden');
                appSection.classList.remove('hidden');
                navAuth.classList.remove('hidden');
                mobileNav.classList.remove('hidden');
                listenToUserData(user.uid);
                updateMarketPrices();
                setInterval(updateMarketPrices, 60000); // Update every minute
            } else {
                authSection.classList.remove('hidden');
                appSection.classList.add('hidden');
                navAuth.classList.add('hidden');
                mobileNav.classList.add('hidden');
            }
        });

        function listenToUserData(uid) {
            db.collection('users').doc(uid).onSnapshot(doc => {
                const data = doc.data();
                if(!data) return;
                currentUserData = data;
                document.getElementById('header-user-name').innerText = data.name;
                document.getElementById('header-user-tier').innerText = data.tier + " Level";
                updateDashboardUI(data);
                
                if (data.isAdmin) {
                    document.getElementById('admin-tab-btn').classList.remove('hidden');
                    loadAdminData();
                }
            });
        }

        const RATES = { Silver: 0.01, Gold: 0.015, Diamond: 0.02 };

        function updateDashboardUI(data) {
            const capital = data.investedCapital || 0;
            const tier = data.tier || 'None';
            
            document.getElementById('stat-capital').innerText = `$${capital.toLocaleString()}`;
            document.getElementById('user-tier-badge').innerText = tier;

            if (capital > 0 && data.investmentDate) {
                const start = data.investmentDate.toDate();
                const now = new Date();
                const hoursPassed = (now - start) / (1000 * 60 * 60);
                const intervals = Math.floor(hoursPassed / 12);
                
                const rate = RATES[tier] || 0;
                const currentRevenue = capital * Math.pow(1 + rate, intervals);
                const projected = capital * Math.pow(1 + rate, intervals + 6);

                document.getElementById('stat-revenue').innerText = `$${currentRevenue.toLocaleString(undefined, {minimumFractionDigits: 2})}`;
                document.getElementById('stat-projected').innerText = `$${projected.toLocaleString(undefined, {minimumFractionDigits: 2})}`;

                const daysPassed = hoursPassed / 24;
                const statusEl = document.getElementById('eligibility-status');
                if (daysPassed >= 30) {
                    statusEl.innerHTML = `<i class="fas fa-check-circle text-green-500"></i> <span class="text-green-400 font-bold uppercase">Ready for Withdrawal</span>`;
                } else {
                    const remaining = Math.ceil(30 - daysPassed);
                    statusEl.innerHTML = `<i class="fas fa-clock text-yellow-500"></i> <span class="text-slate-300 uppercase">Lock ends in ${remaining} days</span>`;
                }
            } else {
                document.getElementById('stat-revenue').innerText = "$0.00";
                document.getElementById('stat-projected').innerText = "$0.00";
                document.getElementById('eligibility-status').innerHTML = `<i class="fas fa-info-circle text-blue-500"></i> <span class="text-slate-400">No active investment found</span>`;
            }
        }

        async function updateMarketPrices() {
            try {
                const res = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin,ethereum,solana&vs_currencies=usd');
                const data = await res.json();
                document.getElementById('price-btc').innerText = `$${data.bitcoin.usd.toLocaleString()}`;
                document.getElementById('price-eth').innerText = `$${data.ethereum.usd.toLocaleString()}`;
                document.getElementById('price-sol').innerText = `$${data.solana.usd.toLocaleString()}`;
            } catch (e) { console.warn("Market data throttled or unreachable"); }
        }

        function showTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(el => {
                el.classList.remove('bg-blue-600');
                el.classList.add('text-slate-400');
            });
            
            document.getElementById(`tab-${tabId}`).classList.add('active');
            event.currentTarget.classList.add('bg-blue-600');
            event.currentTarget.classList.remove('text-slate-400');
            
            // Sync mobile icons
            document.querySelectorAll('#mobile-nav button').forEach(b => b.classList.add('text-slate-500'));
            // Find mobile matching button and light it up if possible
        }

        function initiateDeposit(tier) {
            const wallet = "bc1qxy2kgdygjrsqtzq2n0yrf2493p83kkfjhx0wlh"; 
            const msg = `INVESTMENT PORTAL\n\nTier: ${tier}\nNetwork: BTC SegWit\n\nAddress: ${wallet}\n\nTransfer the amount and contact support for manual activation.`;
            alert(msg);
        }

        function requestWithdrawal() {
            const amount = document.getElementById('withdraw-amount').value;
            if (!amount || amount <= 0) return showToast("Enter a valid amount", true);
            showToast("Withdrawal ticket generated. Awaiting blockchain confirmation.");
        }

        // --- ADMIN ---
        async function loadAdminData() {
            db.collection('users').onSnapshot(snapshot => {
                const list = document.getElementById('admin-user-list');
                list.innerHTML = '';
                snapshot.forEach(doc => {
                    const u = doc.data();
                    if (u.uid === auth.currentUser.uid) return;
                    list.innerHTML += `
                        <tr class="hover:bg-slate-800/30 transition-all">
                            <td class="py-4">
                                <p class="font-bold text-sm">${u.name}</p>
                                <p class="text-[10px] text-slate-500">${u.email}</p>
                            </td>
                            <td><span class="text-[10px] px-2 py-1 bg-slate-800 rounded-full font-bold text-slate-300 uppercase">${u.tier}</span></td>
                            <td class="font-bold text-sm text-blue-400">$${u.investedCapital.toLocaleString()}</td>
                            <td>
                                <button onclick="updateUserPrompt('${u.uid}')" class="text-xs font-bold text-blue-500 hover:text-blue-400">MANAGE</button>
                            </td>
                        </tr>
                    `;
                });
            });
        }

        async function updateUserPrompt(uid) {
            const newCapital = prompt("Update Capital Amount (USD):");
            const newTier = prompt("Assign Tier (Silver, Gold, Diamond):");
            if (newCapital !== null && newTier !== null) {
                await db.collection('users').doc(uid).update({
                    investedCapital: parseFloat(newCapital),
                    tier: newTier,
                    investmentDate: firebase.firestore.Timestamp.now()
                });
                showToast("Investor Record Updated");
            }
        }

        function showToast(msg, isError = false) {
            const t = document.getElementById('toast');
            t.innerText = msg;
            t.style.borderLeft = isError ? "4px solid #ef4444" : "4px solid #3b82f6";
            t.classList.remove('translate-y-32');
            setTimeout(() => t.classList.add('translate-y-32'), 3500);
        }
    </script>
</body>
</html>
